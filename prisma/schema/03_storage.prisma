model StorageMean {
  id          String        @id @default(uuid()) @db.Char(36)
  name        String
  price       Int           @default(0)
  description String?
  status      StorageStatus @default(ACTIVE)
  sop         DateTime      @default(now())
  eop         DateTime      @default(now())

  // ✅ choisis UNE convention : mm + m² (ici)
  heightMm        Int     @default(0)
  usefulSurfaceM2 Decimal @default(0) @db.Decimal(10, 2) // surface en m²
  grossSurfaceM2  Decimal @default(0) @db.Decimal(10, 2)

  supplierId String?   @db.Char(36)
  supplier   Supplier? @relation(fields: [supplierId], references: [id])

  plantId String @db.Char(36)
  plant   Plant  @relation(fields: [plantId], references: [id])

  // ✅ multi-flows via pivot
  flows StorageMeanFlow[]

  storageMeanCategoryId String?              @db.Char(36)
  storageMeanCategory   StorageMeanCategory? @relation(fields: [storageMeanCategoryId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  images StorageMeanImage[]

  // ✅ spécifiques
  staffingLines StaffingLine[]
  laneGroups    LaneGroup[]
  highBayRack   HighBayRackSpec?

  @@unique([plantId, name, storageMeanCategoryId])
  @@index([plantId])
  @@index([storageMeanCategoryId])
}

model StorageMeanCategory {
  id          String   @id @default(uuid()) @db.Char(36)
  name        String   @default("Description of storage mean category")
  slug        String   @unique
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  image StorageMeanCategoryImage?

  storageMeans StorageMean[]
}

model Lane {
  id String @id @default(uuid()) @db.Char(36)

  laneGroupId String    @db.Char(36)
  laneGroup   LaneGroup @relation(fields: [laneGroupId], references: [id], onDelete: Cascade)

  lengthMm Int @default(0)
  widthMm  Int @default(0)
  heightMm Int @default(0)

  numberOfLanes Int @default(1)

  level    Int      @default(0) // 0 = sol
  laneType LaneType @default(ACCUMULATION)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([laneGroupId])
  @@index([laneGroupId, level])
}

model LaneGroup {
  id String @id @default(uuid()) @db.Char(36)

  storageMeanId String      @db.Char(36)
  storageMean   StorageMean @relation(fields: [storageMeanId], references: [id], onDelete: Cascade)

  name        String? // ex: "Buffer A", "Zone Retours vides"
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  lanes Lane[]

  @@index([storageMeanId])
}

model HighBayRackSpec {
  storageMeanId String      @id @db.Char(36)
  storageMean   StorageMean @relation(fields: [storageMeanId], references: [id], onDelete: Cascade)

  numberOfLevels Int @default(0)
  numberOfBays   Int @default(0)

  slotLengthMm Int @default(0)
  slotWidthMm  Int @default(0)
  slotHeightMm Int @default(0)

  numberOfSlots Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model StorageMeanFlow {
  storageMeanId String @db.Char(36)
  flowId        String @db.Char(36)

  // optionnel mais pratique si tu veux ordonner/qualifier un flow
  sortOrder Int     @default(0)
  notes     String?

  storageMean StorageMean @relation(fields: [storageMeanId], references: [id], onDelete: Cascade)
  flow        Flow        @relation(fields: [flowId], references: [id], onDelete: Cascade)

  @@id([storageMeanId, flowId])
  @@index([flowId])
  @@index([storageMeanId, sortOrder])
}

model StaffingLine {
  id String @id @default(uuid()) @db.Char(36)

  storageMeanId String      @db.Char(36)
  storageMean   StorageMean @relation(fields: [storageMeanId], references: [id], onDelete: Cascade)

  shift         ShiftType
  workforceType WorkforceType

  qty Decimal @default(0) @db.Decimal(5, 2)

  role        String
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([storageMeanId])
  @@index([storageMeanId, shift])
  @@index([storageMeanId, workforceType])
}
